@page "{userId:int}"
@model CookingAssistantAPI.Pages.HomePageModel
@{
    ViewData["Title"] = "Home";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Home Specific CSS -->
    <link href="/css/home.css?v=@DateTime.Now.Ticks" rel="stylesheet" />  <!-- Using home.css for HomePage styles -->
</head>
<body>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center">
            <h1>Welcome, @Model.UserName!</h1>
            <div>
                <button class="btn btn-create-recipe me-2" onclick="redirectToCreateRecipe(@Model.UserId)">Create Recipe</button>
                <button class="btn btn-secondary me-2">Profile</button>
                <button class="btn btn-logout" onclick="redirectToLogin()">
                    <img src="/images/logout_icon.svg?v=@DateTime.Now.Ticks" alt="Logout icon" /> Logout
                </button>
            </div>
        </div>

        <div class="row mt-3">
            <!-- Search Box -->
            <div class="col-md-6">
                <input type="text" class="form-control" placeholder="Search recipes..." id="searchBox" />
            </div>

            <!-- Pantry Button -->
            <div class="col-md-6">
                <button class="btn btn-warning">Pantry</button>
            </div>
        </div>

        <!-- User's Recipes Section -->
        <div class="row mt-4">
            <h3>My Recipes</h3>
            <div class="d-flex flex-wrap">
                @foreach (var recipe in Model.MyRecipes)
                {
                    <a href="@Url.Page("/RecipeDetails", new { recipeId = recipe.RecipeId, userId = @Model.UserId })" class="text-decoration-none text-dark">
                        <div class="card" style="width: 18rem; margin: 10px;">
                            <img src="/api/recipes/@recipe.RecipeId/image" class="card-img-top" alt="@recipe.Title image">
                            <div class="card-body">
                                <h5 class="card-title">@recipe.Title</h5>
                            </div>
                        </div>
                    </a>
                }
            </div>
        </div>

        <!-- Top Rated Recipes Section -->
        <div class="row mt-4">
            <h3>Top Rated Recipes</h3>
            <div class="d-flex flex-wrap">
                @foreach (var recipe in Model.TopRatedRecipes)
                {
                    <a href="@Url.Page("/RecipeDetails", new { recipeId = recipe.RecipeId, userId = @Model.UserId })" class="text-decoration-none text-dark">
                        <div class="card" style="width: 18rem; margin: 10px;">
                            <img src="/api/recipes/@recipe.RecipeId/image" class="card-img-top" alt="@recipe.Title image">
                            <div class="card-body">
                                <h5 class="card-title">@recipe.Title</h5>
                                <p class="card-text">Average Rating: @recipe.Ratings.Average(rt => rt.Value) / 5</p>
                            </div>
                        </div>
                    </a>
                }
            </div>
        </div>
    </div>

    <!-- JavaScript function for redirecting to CreateRecipe page -->
    <script>
        function redirectToCreateRecipe(userId) {
            window.location.href = `/CreateRecipe/${userId}`;
        }

        function redirectToLogin() {
            // Redirect the user to the login page. This will effectively log them out if the session is managed server-side.
            window.location.href = '/Login';
        }
    </script>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
